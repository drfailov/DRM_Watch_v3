
<!-- For new line: \ -->
<!-- Picture: <img src="Photos/" width="300"/>  -->
<!-- New Line: "  <br>"  -->

# Про проект DRM Watch 3

<p align="center">
<img src="Photos/DRM_welcome.jpg" width="700"/>
</p>

**DRM Watch 3** - це мій саморобний наручний годинник, в основі якого лежить дисплей Sharp Memory LCD, ESP32-S2 і бажання носити це на руці:)  <br>
Це **НЕ "Smart годинник"**! Цей пристрій по своїй функціональності близький до звичайного електронного годинника, з кількома додатковими можливостями, і їх можна додавати, перепрограмовувати годинник під себе.  <br>
Наразі в прошивці є всі можливості, що притаманні типовому годиннику і що дозволяє повноцінно використовувати його на щоденній основі.  <br>
В цьому репозиторії можна знайти інфу і інструкції **щоб зібрати собі такий годинник**.  <br>
  <br>
Це у мене таке хобі:) Я в кінці 2023 поліз вивчати проектування плат, після появи 3д принтера в 2022 поліз вивчати 3д моделювання, а за освітою програміст.  От власне це все і зібралось воєдино в цьому проекті) Робив це все з нуля. А яка б класна з цього була дипломна робота)))  <br>
  <br>
Посилання що наведено в цьому тексті є актуальними станом на **2024-04**. Якщо якісь товари будуть вже не актуальні, то шукайте за фотками))  <br>
  <br>


## Фото
<p align="center">
<img src="Photos/cad-angle.png" width="200"/>
<img src="Photos/cad-front.png" width="200"/>
<img src="Photos/cad-side.png" width="200"/>
</p>

<p align="center">
<img src="Photos/DSC_3058.jpg" width="600"/>
</p>
<p align="center">
<img src="Photos/DSC_3069.jpg" width="200"/>
<img src="Photos/DSC_3055.jpg" width="200"/>
<img src="Photos/DSC_3094.jpg" width="200"/>
</p>
<p align="center">
<img src="Photos/DSC_3077.jpg" width="200"/>
<img src="Photos/DSC_3101.jpg" width="200"/>
<img src="Photos/DSC_3063.jpg" width="200"/>
</p>
<p align="center">
<img src="Photos/DSC_3084.jpg" width="200"/>
<img src="Photos/DSC_3097.jpg" width="200"/>
<img src="Photos/DSC_3115.jpg" width="200"/>
</p>


## Особливості годинника
- Зроблено в Україні;
- Стабільно працює і підходить для щоденного користування;
- Дисплей завжди показує час;
- Є дуже тускла але дуже приємна нічна підсвітка дисплея;
- Є ліхтарик, білий яскравий та червоний нічний;
- Акумулятора вистачає на понад 20днів, є індикатор заряду;
- Зручні меню, звідки можна отримати доступ до всіх функцій;
- Наявність Wi-Fi, можна зберегти до 8 мереж в пам'яті;
- Можливість синхронізації часу по Wi-Fi;
- Багато мелодій. Їх можна або просто слухати або встановити на будильник.
- Імітація звуку мявчання кошенят;
- Кілька циферблатів, які можна налаштувати;
- Секундомір, працює в фоні;
- Будильники, до 6шт з назвами;
- Вічний календар (або я ще не догортав до кінця);
- Повнекранні клітинні автомати та анімації (Життя, Мураха, Вогонь, Шум)
- Зарядка по USB, в тому числі від TypeC-TypeC;
- Можна оновлювати прошивку по USB, не розбираючи годинник.
- Компоненти для збірки легко дістати;
- Корпус підходить для стандартних 22мм ремінців;
- Якщо під час експериментів з прошивками годинник завис, в корпусі передбачено отвір щоб голкою його перезавантажити.
- Водонепроникність до 0 метрів:) (можна трохи покращити якщо при збірці обробити плату лаком а корпус збирати з клеєм.)
- Годинник можна використовувати як поле для експериментів з ESP32-S2: акумулятор, 3 кнопки, пищалка, дисплей, 3 світлодіоди;
- Екран "Про годинник" містить інформацію про розробника та версію прошивки.


## Застереження під час користування:
- Годинник **не можна мочити**. Захист від води тут майже відсутній і це призведе до поломки годинника. Від дрібного дощу або поту йому нічого не буде, а от залити при митті рук - може бути проблемою.
- Годинник **слабко захищений від ударів**. Дисплей не захищений, тонкі рамки, тонкий корпус, годинник спроектований без великого запасу механічної міцності, так він  ще й досить габаритний. Тому вдарити його легко, і це скоріше за все призведе до розбитого дисплея. Протягом моїх місяців експлуатації проблем з пошкодженням годинника не було, але я користувався досить обережно.
- Годинник варто **оберігати від впливу статики**. Є невеликий шанс вбити годинник якщо швидко змімати з себе светр) Тому або знімайте светр повільно, або зніміть перед цим годинник, або використовуйте светр який не електризується. Особливо ризикований момент - постановка на зарядку, тут може проскочити прямо через контроллер. Раджу перед тим як вставити кабель зарядки, доторкнутись до металевої частини корпусу зарядного пристрою - так ви розрядитесь через корпус, а не через годинник і все буде ок.



## Короткий відео огляд годинника:
[<p align="center"><img width="300px" src="Photos/Screenshot 2024-04-21 161551.png" /> </p>](https://www.youtube.com/watch?v=3oIwZVaCEvY) 
<p align="center">https://www.youtube.com/watch?v=3oIwZVaCEvY </p>


## Короткий відео огляд мелодій:
[<p align="center"><img width="300px" src="Photos/Screenshot 2024-04-21 161739.png" /> </p>](https://www.youtube.com/watch?v=Ylm3CU0DTDE) 
<p align="center">https://www.youtube.com/watch?v=Ylm3CU0DTDE </p>







# Опис меню, функцій та екранів

## Основний екран, циферблат
Тут відображаєтья час. Це основний екран годинника, на нього переходят більшість екранів по таймеру бездіяльності. На цьому екрані годинник заходить в сон і спить, просинаючись раз в хвилину щоб намалювати час.     <br> 
**Кнопка вгору** (коротке натиснення) - Відкрити секундомір.      <br> 
**Кнопка вгору** (довге натиснення) - Відкрити таймер.      <br> 
**Середня кнопка** (коротке натиснення) - Увімкнути ліхтарик.      <br> 
**Середня кнопка** (довге натиснення) - вимкнути годинник.      <br> 
**Кнопка вниз** - відкрити меню програм.      <br> 

## Програми
Звідси можна запустити функції які не є налаштуваннями. Будильники, секундоміри, ігри, розваги, тощо.
**Кнопками вгору та вниз** - обрати пункт меню.     <br>  
**Центральна кнопка** - активує обраний пункт меню.      <br> 

## Програми -> Будильник
Будильник запускає відтворення заданої мелодії в заданий час дня.
Можна налаштувати кілька будильників. До кожного можна задати час, назву та мелодію. Будильник спрацює якщо годинник заряджений і якщо годинник звісно знає поточний час. Спрацює також якщо в момент спрацювання ви знаходитесь в меню а не на циферблаті, а також спрацює якщо годинник вимкнено (але він при цьому заряджений).     <br>
**Кнопками вгору та вниз** - обрати пункт меню.      <br> 
**Центральна кнопка** активує обраний пункт меню.      <br> 
Коли пункт меню активований, **кнопки вниз та вгору міняють значення пункту**.     <br> 
Під час будильника гратиме обрана мелодія і відображатиметься назва будильника та час на який будильник було встановлено. Під час спрацювання будильника його можна закрити (вимкнути на поточний раз), або вікласти на 10 або 5 хвилин (за умови якщо в цей момент не запущено таймер). Після спрацювання будильника він спрацює знову наступного дня. 

## Програми -> Календар
Показує календар на місяць.
**Кнопками вгору та вниз** - змінити поточний місяць.     <br> 
**Центральна кнопка** - вийти.     <br> 


## Програми -> Таймер
Таймер веде відлік заданого часу від моменту запуску. Коли час спливає, запускається звуковий сигнал.      <br>
Кнопками вгору та вниз задається час на який встановлюється таймер. Центральна кнопка або закриває програму, або запускає таймер.     <br> 
Коли лунає звуковий сигнал, його можна закрити, або вікласти на 10 або 5 хвилин.


## Програми -> Вогонь
Режим повноекранної анімації вогню. Красиво. В основі лежить шум Перліна.    <br>
Будь-яка з кнопок закриває програму.    <br>
Дякую за допомогу з реалізацією Кирилу Лейферу, ось його репозиторій: https://github.com/BOOtak/dct3ngine/blob/master/src/games/perlin_test


## Налаштування -> Вміст циферблату
Одночасно відображатиметься тільки один фон, тому щоб був відображався потрібний фон, потрібно залишити активний тільки один з доступних.    <br>
Кнопками вгору та вниз - обрати пункт меню. Центральна кнопка міняє обраний пункт меню. 


# Де брати комплектуючі
Готових годинників в продажу не існує, тому якщо є бажання отримати такий годинник, можна зібрати самому.

### Дисплей
<p align="center"><img src="Photos/5a768_electronic_circuits_gI_0_MemoryLCDPress.jpg" height="200"/> </p>

Дисплей потрібен, щоб відображати інформацію користувачу:)  <br>
Модель дисплея: **Sharp LS027B7DH01A**    <br>
Він звісно недешений, але мені дуже подобається як він виглядає. Його можна купити готовим, я купував тут:   <br>
https://www.aliexpress.us/item/1005005611440829.html  <br>


### Конектор дисплея
<p align="center"><img src="Photos/fpc.png" height="200"/> </p>

Для підключення цього дисплея. Я купував модулем, але можна пошукати і роз'єм окремо.  <br>
Модель: **FPC 10pin 0.5mm pitch** Я купував тут:    <br>
https://www.aliexpress.us/item/1005002288363000.html   <br>
https://www.aliexpress.us/item/10000348360254.html   <br>


### Акумулятор
<p align="center"><img src="Photos/battery.png" height="200"/> </p>

Якщо потрібно щоб пристрій працював автономно, то потрібен акумулятор.  <br>
Корпус та плата спроектовано під літій-іонний акумулятор такої форми: 35*25*5mm. Звісно, підійде будь-який і меншого розміру, але матиме меншу ємність.  <br>
Модель яка найкраще підходить: **lipo 502535**. Я купував тут:    <br>
https://prom.ua/ua/p1286391849-akkumulyator-kontrollerom-universalnyj.html   <br>

### Буззер
<p align="center"><img src="Photos/buzzer.png" height="200"/> </p>

Буззер потрібен щоб пищати, грати мелодії.  <br>
Модель: **Buzzer SMD 7525-3.6V-passive**. Я купував тут:    <br>
https://www.aliexpress.us/item/1005003620083880.html   <br>
https://eu.mouser.com/ProductDetail/CUI-Devices/CMT-7525S-SMT-TR?qs=qCxwlXJ4fnw4ZHFvNib47A%3D%3D


### Мосфет
<p align="center"><img src="Photos/mosfet.png" height="200"/> </p>

Мосфет використовується для того щоб керувати буззером, щоб на нього надходив не слабкий сигнал з мікроконтроллера, 
а потужний з батареї.    <br>
Модель: **2N7002LT1G**. Можна купити тут:    <br>
https://www.aliexpress.us/item/1005003079655220.html    <br>

### ESP32
<p align="center"><img src="Photos/1333_1.png" height="200"/> </p>

Я розпаював на комплектуючі плати **Lolin S2 Mini**, ось ссилка де я купував:  <br>
https://www.aliexpress.us/item/1005004438665554.html  <br>
  <br>
Якщо немає бажання розпаювати Lolin S2 Mini, можна купити комплектуху окремо:  <br>
<p align="center">
<img src="Photos/esp32s2.png" height=50"/> 
<img src="Photos/quartz.png" height=50"/> 
</p>

Чіп: **ESP32-S2, QFN56**  <br>
https://www.tme.eu/en/details/esp32s2/iot-wifi-bluetooth-modules/espressif/esp32-s2/   <br>
https://eu.mouser.com/ProductDetail/Espressif-Systems/ESP32-S2?qs=GBLSl2Akirtmlui%2FgtDaSQ%3D%3D   <br>
Кварц: **SMD 3225 4pin 40MHz**:  <br>
https://www.aliexpress.us/item/1005004689346275.html  <br>


### Модуль зарядки акумулятора
<p align="center">
<img src="Photos/large_AOC777-1.jpg" height="200"/>  
</p>

Щоб була можливість заряджати акумулятор. Причому якщо акума не буде - годинник не працюватиме навіть на зарядці.   <br>
Тому якщо потрібно обійти модуль зарядки, можна замкнути перемичку біля мікросхеми заряду на платі (вона вона розташована біля самого краю плати) - вона подасть напряму напругу з USB порта замість напруги батареї. Основне не залишити перемичку зі вставленим акумом, щоб не отримати **фаєр-шоу**)))   <br>
Розпаявши такий модуль можна дістати чіп **TP4056** , який відоповідає за зарядку акума. Датащит:  <br>
https://dlnmh9ip6v2uc.cloudfront.net/datasheets/Prototyping/TP4056.pdf  <br>
Якщо нема бажання розпаювати модуль, можна знайти окремо:  <br>
<p align="center">
<img src="Photos/tp4056.png" height=50"/> 
<img src="Photos/usb.png" height=50"/> 
<img src="Photos/led.png" height=50"/> 
</p>

Чіп: **TP4056**  <br>
https://www.alibaba.com/product-detail/TC4056A-SOP-8-is-compatible-with_1600806443781.html  <br>
Роз'єм: **TYPE-C-31-M-12**  <br>
https://jlcpcb.com/partdetail/Korean_HropartsElec-TYPE_C_31_M12/C165948  <br>
Світлодіод: **0805 SMD LED**  <br>
https://www.aliexpress.us/item/4000936781234.html  <br>


### SMD Резистори
<p align="center"><img src="Photos/resistors.png" height="200"/>  </p>

Я робив плату під резистори **SMD 0603** (переважно), їх я брав з такого набору:   <br>
https://www.aliexpress.us/item/1005002364437129.html   <br>


### SMD Конденсатори
<p align="center"><img src="Photos/capacitorset.png" height="200"/>  </p>

Я робив плату під конденсатори **SMD 0603** (переважно), їх я брав з такого набору:   <br>
https://www.aliexpress.us/item/1005006124283234.html   <br>


### RTC модуль
<p align="center">
<img src="Photos/rtc.png" height="200"/>   
<img src="Photos/rtcchip.png" height="200"/>  
</p>

Використовується мікросхема **Analog Devices DS3231**, я її купував в складі такого модуля:   <br>
https://www.aliexpress.us/item/32822420722.html   <br>
Але можна також знайти мікросхеми окремо. Ось ще трохи інфи по ним:   <br>
https://octopart.com/ds3231-maxim+integrated-14739425
https://www.analog.com/en/products/ds3231.html   <br>
https://www.analog.com/media/en/technical-documentation/data-sheets/DS3231.pdf   <br>


### Світлодіод ліхтарика
<p align="center">
<img src="Photos/020led.png" height="200"/>  
<img src="Photos/lcd-backlight.png" height="200"/>  
</p>

Ці світлодіоди я діставав виключно з підсвітки старих телефонів, бо їх дисплеїв у мене багато.   <br>
Але я знайшов їх типорозмір щоб можна було замовити окремо: **020 SMD Side View LED White 6000K**.   <br>
Знайшов що тут можна замовити:  <br>
https://www.aliexpress.us/item/32419907074.html   <br>


### Кнопки
<p align="center"><img src="Photos/buttons.png" height="200"/>  </p>

Я так і не знайшов як їх можна назвати, тому шукаємо по фото і цьому тексту: **2*4*3.5mm Micro SMD Tact Switch Side Button**  <br>
https://www.aliexpress.us/item/32880903601.html    <br>


### Місця для гвинтів

Такі можна знайти на материнці DJI Mavic 3. Під гвинт М1.2  <br>
Щось схоже:  <br>
Обирати SMTSO-M1.2-2  <br>
https://www.aliexpress.com/i/1005005125674149.html  <br>

https://www.swaco.com/SMTSO-M1.2-2ET-PEM-ReelFast  <br>

SMTSO-M1.2-2ET  <br>
https://eu.mouser.com/ProductDetail/PEM/SMTSO-M1.2-2ET?qs=l4Gc20tDgJKS2GEfMx1Yrw%3D%3D  <br>



### Електролюмінесцентна панель
<p align="center"><img src="Photos/el.png" height="200"/>  </p>

Цей елемент можна ставити або не ставити за бажанням, залежно від того чи потрібна вам нічна підсвітна екрана.   <br>
Електролюмінесцентна панель (EL панель) є складовою частиною системи підсвітки. Це панель, що світиться під впливом високої напруги і частоти. Також їх називають світлоконденсаторами (LEC). Це просто цікаві факти щоб краще розуміти що воно таке.  <br>
Фішка цього типу підсвітки в тому, що панель є дуже тонка, світить дуже рівномірно приємним синім кольором, а також її можна нарізати на фрагменти потрібної форми. Але після порізки складною є задача підключення до панелі. Я для підключення використовував одиночні жили дроти а також токопровідний клей.  <br>
Мінуси: будучи розташована за дисплеєм який тут використовується, її ледь-ледь видно, але вночі цього достатньо. Також трохи пищить при роботі. А ще для її роботи потрібна досить складна схема драйвера.  <br>
Раджу купувати синій колір, тому що EL панель натівно такого кольору, а в інші кольори її тупо фарбують, а фарба поглинає частину світла. Якщо прийшла пофарбована панель, її можна очистити від фарби лезом.  <br>
Ось де я купував:  <br>
https://www.aliexpress.us/item/1005003971896012.html  <br>


### Драйвер електролюмінесцентної панелі
<p align="center"><img src="Photos/h857.png" height="200"/>  </p>

Цей елемент можна ставити або не ставити за бажанням, залежно від того чи потрібна вам нічна підсвітна екрана.   <br>
Це та мікросхема, яка і формує змінну високу напругу для електролюмінесцентної панелі.   <br>
Схему її підключення я не розумію, просто зібрав по схемі і воно запрацювало))   <br>
Модель: **Microchip HV857MG MSOP8**   <br>
Датащит:   <br>
https://ww1.microchip.com/downloads/aemDocuments/documents/APID/ProductDocuments/DataSheets/HV857-High-Voltage-Low-Noise-EL-Lamp-Driver-IC-Data-Sheet-DS20005683.pdf   <br>
Я купував тут:  <br>
https://www.aliexpress.us/item/1005005512523052.html  <br>


### Обвязка драйвера електролюмінесцентної панелі
<p align="center">
<img src="Photos/capacitor.png" height=50"/> 
<img src="Photos/capacitorset.png" height=50"/> 
<img src="Photos/es1d.png" height=50"/> 
<img src="Photos/l.png" height=50"/> 
</p>

Цей елемент можна ставити або не ставити за бажанням, залежно від того чи потрібна вам нічна підсвітка екрана.   <br>
Насправді я в цій мелочовці взагалі не шарю, причому навіть деякі елементи замовив не ті що треба було... Але у мене воно запрацювало. Тому я кладу тут ссилки на те що я конкретно замовляв.   <br>

Модель: **Capacitor SMD 1206 10NF X7R 200V**   <br>
https://www.aliexpress.us/item/1005004628006766.html   <br>

Модель: **1206 320PCS 16Value**   <br>
https://www.aliexpress.us/item/1005006124283234.html   <br>

Модель: **Diode ES1D**   <br>
https://www.aliexpress.us/item/1005005254835443.html   <br>

Модель: **SMD Inductor 1210 3225 22UH**   <br>
https://www.aliexpress.us/item/32981310345.html   <br>


### Клей для електролюмінесцентної панелі
<p align="center"><img src="Photos/mechanic.png" height="200"/>  </p>


Цей елемент можна ставити або не ставити за бажанням, залежно від того чи потрібна вам нічна підсвітка екрана.   <br>
Цей клей я використовую для того щоб під'єднати дроти до електролюмінесцентної панелі. Детальніше про процес можна почитати в розділі "процес збірки".   <br>
Модель: **MECHANIC MCN-DJ002 Conductive Adhesive Glue Silver**   <br>
https://www.aliexpress.us/item/1005002369819447.html   <br>


### Ремінець
<p align="center">
<img src="Photos/band.png" height="200"/>  
<img src="Photos/pin.png" height="200"/>
<img src="Photos/pin-hole.png" height="200"/> 
</p>

Можна купити на алі, вибір великий. Потрібні стандартні ремінці **шириною 22мм**.   <br>
До прикладу, можна замовити тут:   <br>
https://www.aliexpress.us/item/1005005890436737.html   <br>

До ремінців як правило йдуть в комплекті і піни для встановлення, але якщо його в комплекті нема, можна замовити окремо:   <br>
https://www.aliexpress.us/item/1005006026719458.html   <br>


## Корпус
<p align="center">
<img src="Photos/case-front.png" height="250"/>  
<img src="Photos/case-back.png" height="250"/>
<img src="Photos/case-buttons.png" height="100"/>
</p>

Корпус спроектовано для простоти збірки та простоти друку на FDM 3D принтері. При цьому можна також замовити друк металом або фрезерування.  <br>
Малював корпус в Fusion 360, якщо потрібно щось змінювати, відкривайте файли `.f3d`. В папці купа версій, шукайте версію з новішою датою в назві.  <br>
Корпус спроектовано під **ремінці 22мм**.  <br>
Корпусні частини краще друкувати з чорного платику, а вкладку з кнопками - прозорим пластиком, щоб через нього світили ліхтарики.  <br>
В папці багато файлі і моделей, обираючи найновіший дивіться на номер версії або дату в назві файлу.  <br>
Для замовлення фрезерування та лазерного маркування вам знадобиться файл `.step` та `.dwg`.  <br>
Для друку металом або звичайним 3д принтером знадобиться `.stl` файл. (по одному на кожну частину корпусу)

## Плата
<p align="center">
<img src="Photos/board1.png" height="300"/>  
<img src="Photos/board3.png" height="300"/>  
</p>
<p align="center">
<img src="Photos/board2.png" height="150"/>  
<img src="Photos/board4.png" height="150"/>  
<img src="Photos/board5.png" height="150"/>  
</p>

Корпус спроектований під плату товщиною **0.8mm**. Колір плати можна обирати на свій смак, я обирав чорні.  <br>
В папці можна знайти плати різних ревізій, коротко про ревізії:  <br>
**Rev 1:** конденсатори розміщені надто далеко від контроллера, конденсаторів мало, 
немає елементів що формують EN для контроллера, нема RTC мікросхеми, антена на платі неефективна, 
розпіновка в деяких моментах відрізняється від нової ревізії, елементи розміщені не плотно, немає ніякої підсвітки.  <br>
**Rev 2:** вісутні підтяжки RTC SCL та SDA. Елементи розміщені не плотно, підсвітна світлодіодна і неефективна.  <br>
**Rev 3:** Помилок по схемі наче поки немає, я зібрав і воно одразу запрацювало. 
Підсвітка електролюмінесцентна з драйвером. Компоненти розміщені плотно. Можна поставити великий акум на 500мАг.  <br>
**Rev 4:** Додано піни щоб підключити до RTC окремий акум щоб не збивався час при розрядці акумулятора, 
додано елементи які відповідають за роботу вібро. Поки програмно він ніяк не задіяний, але хай буде.

<br>
Щоб замовити собі плату, можна скористатись файлами в папках GERBER. 
Ці файли достатньо завантажити на сайт не виготовляють плати, я замовляв у **jlcpcb.com**. 
Там одразу має бути видно як виглядатиме плата.   <br>
Якщо потрібно щось поміняти - ставимо KiKad, відкриваєм проект `\Board\_DRM_Watch_v3` і можна міняти.   <br>
Експортувати Gerber на Drl можна в редакторі плат KiKad.  <br>
Також в схемі в проекті я до кожного елемента пододавав інфу про те де його можна замовити (якщо знаю звісно)  <br>

### Замовлення зібраної плати
Деякі виробники плат в Китаї пропонують замовлення плат вже готовими і зібраними (PCBA = PCB Assemply). Як правило процес замовлення не надто автоматизований, а робота таких виробників покладається на роботу менеджерів. Тому такі замовлення вони часто приймають у форматі особистої переписки в месенджерах.  <br>
Для такого замовлення їм треба наступна інформація:
- Gerberи плати. Це формується з редактора плат KiKad в файли `.gbr` і містить інформацію про саму плату (всі її шари). Один файл `.gbr` це один шар плати. Можна взяти в папці `Board/2024-04-18 GERBER REV4` (або новішу).
- Список елемнетів які розміщено на платі, тобто файл BOM. Він формується зі схеми в KiKad в файл `.csv` і містить інформацію про номер елемента на платі, виробника, назву компонента, посилання де його можна замовити, та опис кожного елемента. Можна взяти в папці `Board/2024-04-18 GERBER REV4` (або новішу).
- Інформацію про розміщення елементів на поверхні плати. В моєму випадку це окремий шар на Gerber плати, а саме `DRM_Watch_V3-F_Fab.gbr`. Там я розписав розміщення елементів, причому я робив це для себе в довільному по суті форматі, але цей файл підійшов для замовлення.
- Інформація про тип плати, в моєму випадку це товщина **0.8mm** та колір чорний.



# Процес збірки та налагодження

## Підготовка електролюмінесцентної панелі
<p align="center">
<img src="Photos/el1.png" height=180"/> 
<img src="Photos/el2.png" height=180"/> 
<img src="Photos/el3.png" height=180"/> 
<img src="Photos/el4.png" height=180"/> 
</p>

Оскільки щоб встановити електролюмінесцентну панель, її потрібно **порізати**, то з'являється проблема її підключення, 
адже контакти панелі відріжуться. Окрім того все підключення слід виконати **дуже компактно**, оскільки місця під дисплеєм мало.   <br>
У тих панелей що я замовляв, на зворотній стороні можна було бачити, що два контакти які живлять панель **проходять по вьому її периметру**. В них і будем підключатись. Щоб все працювало треба один дріт підключити до зовнішнього електрода, а другий до центрального.   <br>
Підключатись будемо одною **тонкою жилою багатожильного дроту**. Вона звісно дуже тендітна, але в зібраному годиннику це не проблема.   <br>
Я робив так: 
- беремо гостре (свіже, незатуплене) лезо, і під мікроскопом **розрізаємо ламінацію панелі**. Діяти треба обережно, щоб не пошкодити 
нічого зайвого.   <br>
- Далі в цей розріз обережно **запихуємо кінець жили дроту**, пінцетом або лезом. Бажано щоб всередину помістилось хоча б 4мм дроту.   <br>
- Далі набираємо на зубочистку провідний клей, зовсім трішки, і **набиваємо провідний клей всередину** вслід за дротом. Далі чекаємо поки клей засохне.   <br>
- Процес засихання клею можна прискорити прогрівши місце поклейки до температути приблизно **100 градусів на хвилин 20**. Я робив це на паяльному столику.   <br>
- Після поклейки вигинаємо жили дроту так щоб вони виходили до контактів `EL1` та `EL2` на платі, і всю цю поклейку і **жили фіксуємо скотчем.**    <br>
<br>

На цьому етапі ми маємо панель з двома надтонкими жилами які виходять з неї. Можна паятись до плати і має працювати.   <br>
Якщо не працює - варіанти звісно два, або платою не генерується напруга або щось не так з панеллю.    <br>
Плату перевірити легко - звичайним мульмиметром в режимі **вимірювання змінної напруги** поміряти між `EL1` та `EL2`. Має бути приблизно 90 вольт змінного струму.   <br> Якщо напруга є - проблема в панелі.

## Інструменти та розхідники
<p align="center"><img src="Photos/preheater.png" height=180"/> </p>

Мені дуже допомогла в пайці така прикольна паяльна станція:  <br>
https://www.aliexpress.us/item/1005005609080807.html  <br>


<p align="center"><img src="Photos/breakout.png" height=180"/> </p>

На етапі налагодження може допомогти такий **QFN56 Breakout Board** який підійде для ESP32-S2 (нагадую, там корпус QFN56)  <br>
https://www.aliexpress.us/item/1005002805132028.html  <br>

<p align="center"><img src="Photos/urethan.png" height=180"/> </p>

**Uretan 71**  <br>
Для покриття плат лаком я використовував таку штуку як **Uretan 71**. Наносив за допомогою маленького пензля в два шари.   <br>


## Інструменти, які я використовував при проектуванні:
- Проектування плати та схеми: **KiCad 7.0.9**;
- Формування BOM: **bom_csv_grouped_by_value_with_fp.py** (розташований в папці `Board`);
- Програмування: **Arduino IDE 2.2.1** + комплект бібліотек в папці `Firmware\Libs`;
- Розширення плати: **esp32 by Espressif v2.0.15, ESP32-S2** (В списку плат оберіть "Lolin S2 Mini");
- Конвертування іконок: **Програма LCD Assistant**. (Виберіть Horizontal).









# Прошивка
Прошивка написана в **Arduino IDE 2.2.1** з використанням розширення плат **esp32 by Espressif v2.0.15, ESP32-S2**, компілювати треба під плату **Lolin S2 Mini**.   <br>
Кожен режим в прошивці (поточний екран, mode) - це комплект функцій які займаються відмальовуванням екрану та обробкою кнопок. Кожен режим може робити по суті що завгодно.   <br>
Основний спосіб навігації в прошивці це `Runnable modeSetup, modeLoop, modeButtonUp, modeButtonCenter, modeButtonDown, modeButtonUpLong, modeButtonCenterLong, modeButtonDownLong`.    <br>
Ці змінні в кожен момент часу містять посилання на функції які відповідають поточному режиму (екрану). 
Коли потрібно перемкнути режим (поточний екран), функція `modeSetup` відновідного режиму має перезаписати ці посилання, 
і відновідно `loop` викликатиметься вже інший, малюватиметься інша інфа, користувач бачитиме інший екран та взаємодіятиме з ним.   <br>
   <br>
   
   
   
   
### Як скомпілювати прошивку
- Скачати **VSCode** (В у мене 1.89.1)
https://code.visualstudio.com/docs/?dv=win64user
- Встановити розширення **PlatformIO** (у мене Core 6.1.15·Home 3.4.4)   
Extensions -> в пошук "PlatformIO IDE" -> Install
- Встановити платформу **Espressif 32** (у мене Core 6.6.0)
PlatformIO Home (Відкривається при запуску) -> бокове меню Platforms -> Emnedded -> в пошук "Espressif 32" -> Install
- Відкрити проект **Firmware\DRM Watch 3**
PlatformIO Home (Відкривається при запуску) -> Open Project -> знайти і обрати папку "Firmware\DRM Watch 3"





### Як додати іконку і використати її в меню
<p align="center"><img src="Photos/icons.png" height="200"/>  </p>

**Загалом послідовність така:**
- Мати іконку 24х24 пікселі, зберегти її в форматі **монохромному BMP форматі**;
- Відкрити програму **LCDAssistant.exe**.
- **Load Image** - Обираємо монохромний BMP файл. Файл відкривається, бачимо що показується правильно.
- **Byte orientation** обираємо **Horizontal**.
- **Save Output** - обираємо текстовий файл куди збережемо код.
- Код вставляємо в файл **Icons.ino** (можна звісно інший, але в цьому проекті так прийнято).
- Формуємо для іконки `draw_` функцію за прикладом інших іконок.
- Вставляємо нашу `draw_` функцію в відображення меню.
- Готово. Компілюємо і має працювати.


**Відео як це зробити:**   <br>
(відео таке трішки простеньке, але суть передає)   <br>
https://www.youtube.com/watch?v=P4BCf7cneI8   <br>


### Як додати до прошивки свою мелодію:
<p align="center"><img src="Photos/melody.png" height="200"/>  </p>


1) Знайти мелодію. Це має бути midi файл у якого один із інструментів має містити мелодію повністю. 
Я для пошуку мелодій використовую сайт https://onlinesequencer.net/sequences . Там же можна підправити мелодію щоб вона краще підійшла для годинника.
2) Конвертувати мелодію в формат мелодій годинника. Для цього я дещо модифікував інструмент від ShivamJoker, який тепер генерує мій формат мелодій. Конвертер знаходиться в папці `Software\MIDI-to-Arduino-main`. Для його роботи встановіть NodeJS собі на комп.	
3) В файлі `MelodyPlayer.ini` додаємо масив даних мелодії в файл а також додаємо мелодію та її ім'я до масиву `melodies`. 
4) Цього має бути достатньо. Компілюємо прошивку і має з'явитись нова мелодія.

Зауважу, що після додавання нової мелодії, вона посуне індекси попередніх мелодій і якщо мелодія була обрана для будильника, вона зміститься.    <br>

Я записав відео процесу додавання мелодії:   <br>
https://www.youtube.com/watch?v=u_XPCM6kgQM

Формат масиву:   <br>
- Додатнє число - частота в Гц який потрібно вітворити
- Від'ємне число - час, скільки треба тримати частоту. Від'ємне число після частоти - тривалість частоти. Якщо від'ємних кілька підряд то це паузи.
- 19 - ідентифікатор кінця мелодії. Його треба ставити обов'язково бо система почне відтворювати сміття із оперативки.


### Відомі конфлікти між бібліотеками або пінами
- Temperature measurement is hanging system if after Wi-Fi usage it were not initialized.
- Pin D17 - Stays ON when firmware update
- Pin D31 - Used for flash communication
- Pin D32 - Used for flash communication

## Процес маркування металевого корпусу:

https://youtube.com/shorts/PZIMB8fdEP8?si=xofTaj4oOFBRnQQU


## Посилання на ресурси

- Дякую за код для "Вогню": https://github.com/BOOtak/dct3ngine/blob/master/src/games/perlin_test

- Big repository of phone melodies where I found some melodies
http://onj3.andrelouis.com/phonetones/unzipped/

- Vibration implementation
https://makeabilitylab.github.io/physcomp/advancedio/vibromotor.html





##Історія проекту
- 2023 рік, я десь наткнувся на відео про sharp memory lcd зрозумів, що дуже хочу собі такий дисплей. Замовив на алі.
- 

